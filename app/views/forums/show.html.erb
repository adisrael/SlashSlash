<% provide(:title, @forum.title) %>

<%= link_to 'Back', search_forum_path %>
<div class="row search">
  <div class="search-result well">
    <h1 style="display:inline;"> <%= @forum.title %> </h1>  
    <% pos = @forum.votos>=0 %>
    <h2 class="votes-<%= pos ? 'green' : 'red' %> ", style="display:inline;"> (<%= pos ? '+': '-'  %> <%= @forum.votos%>)</h2>
    <p></p>
    <p><%= @forum.description %></p>
    <% if user_signed_in? %>
      <%= link_to 'New Publication', new_forum_publication_path %> |
      <%= link_to 'Edit', edit_forum_path(@forum) %> |
      <%= link_to '  Destroy', @forum, method: :delete, data: { confirm: 'Are you sure?' } %> |
      <% if !current_user.moderated_forums.include? @forum%>
        <%= form_tag '/moderate/request' do %>
          <%= hidden_field_tag :forum_id, @forum.id  %>
          <%= hidden_field_tag :user_id, current_user.id  %>
          <%= submit_tag 'Apply as Moderator' %>
        <% end %>
      <% elsif !current_user.accepted(@forum.id)%>
        <p>Pending moderator request.</p>
      <% else %>
        <p>You are Moderator in this forum</p>
        <%= form_tag '/moderate/', method: :delete do %>
          <%= hidden_field_tag :forum_id, @forum.id  %>
          <%= hidden_field_tag :user_id, current_user.id  %>
          <%= submit_tag 'Resign as Moderator' %>
        <% end %>
      <% end %>
    <% else %>
      <p><strong> Sign in to create new publications! </strong></p>
    <% end %>
  </div>
</div>


<p style="margin-left: 30px">
  <% @forum.publications.order(:id).each do | publication | %>
    <div class="row search">
      <div class="search-result well">
        <h3><%= link_to publication.title, publication %></h3>
        <% pos = publication.votos>=0 %>
        <h3 class="votes-<%= pos ? 'green' : 'red' %> "> (<%= pos ? '+': '-'  %> <%= publication.votos%>)</h3>
        <h3> - <%= link_to publication.user.userName, publication.user  %></h3>
      </div>
    </div>

  <% end %>
   <% if @forum.publications.size == 0 %>
  	<em> This forum has no publications </em>
  <% end %>
</p>
