<% provide(:title, @publication.title) %>

<div class="row">
  <div class="col-xs-12">
    <% pos = @publication.votos>=0 %>
    <h1 class="votes-<%= pos ? 'green' : 'red' %> ", style="display:inline;"> (<%= pos ? '+': ''  %> <%= @publication.votos%>)
    </h1><h1 style="display: inline-block;">
      <strong><%= @publication.title %> </strong>
    </h1>

    <p style="font-size:110%;">
      <%= @publication.content %>
    </p>

    <p>
      <strong>By:</strong>
      <%= link_to @publication.user.userName, @publication.user %>
    </p>
    <p>
      <strong>Forum:</strong>
      <%=  link_to @publication.forum.title, @publication.forum %>
    </p>
    <p>
      <strong>Created at:</strong>
      <%= @publication.created_at %>
    </p>

    <% if (user_signed_in?) %>
    <% if current_user.favorite_publications.include?(@publication) %>
      <%= form_for @favorite, method: :delete do |f| %>
      <%= f.hidden_field :publication_id, value: @publication.id  %>
      <%= f.hidden_field :user_id, value: current_user.id  %>
      <%= f.submit 'Unstar' %>
      <% end  %>
    <% else %>
      <%= form_for @favorite do |f| %>
      <%= f.hidden_field :publication_id, value: @publication.id  %>
      <%= f.hidden_field :user_id, value: current_user.id  %>
      <%= f.submit 'Star' %>
      <% end  %>
    <% end  %>
      <div class="arrows">
        <%= form_for @vote, url: votes_path, method: :post do |f| %>
        <%= f.hidden_field :user_id, value: current_user.id  %>
        <%= f.hidden_field :publication_id, value: @publication.id  %>
        <%= f.hidden_field :positive, value: true  %>
        <%= f.submit "\u{2b06}", value: "\u{2b06}", class: 'btn btn-success', disabled: @vote.new_record? ? false : @vote.positive %>
        <% end %>
        <% puts 'here' %>
        <% puts @vote.positive.nil? %>
        <%= form_for @vote, url: votes_path, method: :post do |f| %>
        <%= f.hidden_field :user_id, value: current_user.id  %>
        <%= f.hidden_field :publication_id, value: @publication.id  %>
        <%= f.hidden_field :positive, value: false  %>
        <%= f.submit "\u{2b07}", value: "\u{2b07}", class: 'btn btn-danger', disabled: @vote.new_record? ? false : !@vote.positive %>
        <% end %>
      </div>
    <% end %>
  </div>
  <div class="col-xs-12">
    <h3>Comment Section</h3>
    <ul class="comment-list">
      <%= render(partial: 'comments/comment', collection: @publication.comments) %>
    </ul>
  </div>

    <% if (user_signed_in?) %>
      <%= form_for @comment do |f| %>
      <%= f.text_field :content  %>
      <%= f.hidden_field :user_id, value: current_user.id  %>
      <%= f.hidden_field :commentable_type, value: 'publication'  %>
      <%= f.hidden_field :commentable_id, value: @publication.id  %>
      <%= f.submit class: 'btn btn-default'%>
      <% end %>
    <% end %>
</div>

</p>
<% if user_signed_in? %>
  <% if @publication.user == current_user %>
    <%= link_to 'Edit', edit_publication_path(@publication) %> |
  <% end %>
  <% if check_credentials current_user, @publication %>
  <%= link_to 'Destroy', @publication, method: :delete, data: { confirm: 'Are you sure?' } %> |
  <% end %>
<% end %>
<%= link_to 'Back', @publication.forum %>
<script type="text/javascript">
$(document).ready(()=>{
  $('.reply-link').click(function(){
    const id = this.id;
    $('.reply-form').each(function(index,element){
      $(element).addClass('hide')
      $(element).removeClass('show')
    })
    $(`#comment-${id}`).addClass('show')
    $(`#comment-${id}`).removeClass('hide')

  })
})

</script>
